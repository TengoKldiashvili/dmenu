{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/tengo/Downloads/MenuQR%202/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === \"development\" ? [\"error\", \"warn\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;KAAO,GAAG;AACpE;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/tengo/Downloads/MenuQR%202/lib/limits.ts"],"sourcesContent":["export const LIMITS = {\n  // existing limits\n  FREE_MENU_LIMIT: 10,\n  FREE_CATEGORY_LIMIT: 10,\n  FREE_ITEM_LIMIT: 50,\n\n  // resend\n  RESEND_CODE_COOLDOWN_SECONDS: 60,\n\n  // verify email\n  VERIFY_EMAIL_CODE_TTL_MINUTES: 10,\n  VERIFY_EMAIL_MAX_ATTEMPTS: 5,\n  VERIFY_EMAIL_MAX_SENDS: 3,\n\n  // reset password\n  PASSWORD_RESET_CODE_TTL_MINUTES: 10,\n  PASSWORD_RESET_MAX_ATTEMPTS: 5,\n  FORGOT_PASSWORD_MAX_SENDS: 3,\n\n  //blocked user for wrong email or password not ip lock\n  BLOCKED_USER: 5,\n  TIME_BLOCKED_USER:5\n} as const;\n"],"names":[],"mappings":";;;;AAAO,MAAM,SAAS;IACpB,kBAAkB;IAClB,iBAAiB;IACjB,qBAAqB;IACrB,iBAAiB;IAEjB,SAAS;IACT,8BAA8B;IAE9B,eAAe;IACf,+BAA+B;IAC/B,2BAA2B;IAC3B,wBAAwB;IAExB,iBAAiB;IACjB,iCAAiC;IACjC,6BAA6B;IAC7B,2BAA2B;IAE3B,sDAAsD;IACtD,cAAc;IACd,mBAAkB;AACpB"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///Users/tengo/Downloads/MenuQR%202/app/api/auth/verify-email/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport bcrypt from \"bcryptjs\";\nimport { db } from \"@/lib/db\";\nimport { LIMITS } from \"@/lib/limits\";\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const email = String(body.email || \"\").trim();\n    const code = String(body.code || \"\").trim();\n\n    if (!email || !code) {\n      return NextResponse.json({ error: \"generic\" }, { status: 400 });\n    }\n\n    const record = await db.emailVerificationCode.findUnique({\n      where: { email },\n    });\n\n    if (!record) {\n      return NextResponse.json({ error: \"invalidCode\" }, { status: 400 });\n    }\n\n    if (record.expiresAt < new Date()) {\n      await db.emailVerificationCode.delete({ where: { email } });\n      return NextResponse.json({ error: \"codeExpired\" }, { status: 400 });\n    }\n\n    if (record.attempts >= LIMITS.VERIFY_EMAIL_MAX_ATTEMPTS) {\n      return NextResponse.json({ error: \"tooManyAttempts\" }, { status: 429 });\n    }\n\n    const isValid = await bcrypt.compare(code, record.codeHash);\n\n    await db.emailVerificationCode.update({\n      where: { email },\n      data: { attempts: { increment: 1 } },\n    });\n\n    if (!isValid) {\n      return NextResponse.json({ error: \"invalidCode\" }, { status: 400 });\n    }\n\n    const exists = await db.user.findUnique({ where: { email } });\n    if (exists) {\n      await db.emailVerificationCode.delete({ where: { email } });\n      return NextResponse.json({ error: \"alreadyVerified\" }, { status: 400 });\n    }\n\n    await db.user.create({\n      data: {\n        email,\n        passwordHash: record.passwordHash,\n        name: record.name,\n      },\n    });\n\n    await db.emailVerificationCode.delete({ where: { email } });\n\n    return NextResponse.json({ ok: true });\n  } catch (err) {\n    console.error(\"VERIFY EMAIL ERROR:\", err);\n    return NextResponse.json({ error: \"generic\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,QAAQ,OAAO,KAAK,KAAK,IAAI,IAAI,IAAI;QAC3C,MAAM,OAAO,OAAO,KAAK,IAAI,IAAI,IAAI,IAAI;QAEzC,IAAI,CAAC,SAAS,CAAC,MAAM;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAU,GAAG;gBAAE,QAAQ;YAAI;QAC/D;QAEA,MAAM,SAAS,MAAM,iHAAE,CAAC,qBAAqB,CAAC,UAAU,CAAC;YACvD,OAAO;gBAAE;YAAM;QACjB;QAEA,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,IAAI,OAAO,SAAS,GAAG,IAAI,QAAQ;YACjC,MAAM,iHAAE,CAAC,qBAAqB,CAAC,MAAM,CAAC;gBAAE,OAAO;oBAAE;gBAAM;YAAE;YACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,IAAI,OAAO,QAAQ,IAAI,yHAAM,CAAC,yBAAyB,EAAE;YACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,MAAM,OAAO,QAAQ;QAE1D,MAAM,iHAAE,CAAC,qBAAqB,CAAC,MAAM,CAAC;YACpC,OAAO;gBAAE;YAAM;YACf,MAAM;gBAAE,UAAU;oBAAE,WAAW;gBAAE;YAAE;QACrC;QAEA,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,MAAM,SAAS,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC3D,IAAI,QAAQ;YACV,MAAM,iHAAE,CAAC,qBAAqB,CAAC,MAAM,CAAC;gBAAE,OAAO;oBAAE;gBAAM;YAAE;YACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,iHAAE,CAAC,IAAI,CAAC,MAAM,CAAC;YACnB,MAAM;gBACJ;gBACA,cAAc,OAAO,YAAY;gBACjC,MAAM,OAAO,IAAI;YACnB;QACF;QAEA,MAAM,iHAAE,CAAC,qBAAqB,CAAC,MAAM,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAEzD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAU,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACF"}}]
}