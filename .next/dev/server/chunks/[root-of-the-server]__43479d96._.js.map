{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/tengo/Downloads/MenuQR%202/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === \"development\" ? [\"error\", \"warn\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;KAAO,GAAG;AACpE;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///Users/tengo/Downloads/MenuQR%202/lib/mailer.ts"],"sourcesContent":["import nodemailer from \"nodemailer\";\n\ninterface EmailConfig {\n  host: string;\n  port: number;\n  user: string;\n  pass: string;\n  from: string;\n}\n\nconst config: EmailConfig = {\n  host: process.env.EMAIL_HOST || \"smtp.gmail.com\",\n  port: Number(process.env.EMAIL_PORT) || 465,\n  user: process.env.EMAIL_USER!,\n  pass: process.env.EMAIL_PASS!,\n  from: process.env.EMAIL_FROM || process.env.EMAIL_USER!,\n};\n\nif (!config.user || !config.pass) {\n  throw new Error(\n    \"‚ö†Ô∏è CRITICAL: Email credentials are missing. Check your .env file.\"\n  );\n}\n\nconst transporter = nodemailer.createTransport({\n  host: config.host,\n  port: config.port,\n  secure: config.port === 465, \n  auth: {\n    user: config.user,\n    pass: config.pass,\n  },\n});\n\nconst getVerificationEmailTemplate = (code: string) => `\n  <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px;\">\n    <h2 style=\"color: #333; text-align: center;\">Verify your Email</h2>\n    <p style=\"font-size: 16px; color: #555;\">Hello,</p>\n    <p style=\"font-size: 16px; color: #555;\">Use the code below to complete your verification process:</p>\n    <div style=\"background-color: #f4f4f4; padding: 15px; text-align: center; border-radius: 5px; margin: 20px 0;\">\n      <span style=\"font-size: 24px; font-weight: bold; letter-spacing: 5px; color: #000;\">${code}</span>\n    </div>\n    <p style=\"font-size: 14px; color: #888; text-align: center;\">This code will expire in 10 minutes.</p>\n    <hr style=\"border: none; border-top: 1px solid #eee; margin: 20px 0;\" />\n    <p style=\"font-size: 12px; color: #aaa; text-align: center;\">If you didn't request this, please ignore this email.</p>\n  </div>\n`;\n\nexport async function sendVerificationCode(email: string, code: string) {\n  try {\n    const info = await transporter.sendMail({\n      from: config.from,\n      to: email,\n      subject: \"üîê Your Verification Code\",\n      html: getVerificationEmailTemplate(code),\n    });\n\n    console.info(`‚úÖ Verification email sent to ${email}. ID: ${info.messageId}`);\n    return { success: true, messageId: info.messageId };\n\n  } catch (error) {\n    console.error(\"‚ùå Failed to send verification email:\", error);\n    \n    throw new Error(\"Could not send verification email. Please try again later.\");\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAUA,MAAM,SAAsB;IAC1B,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;IAChC,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,KAAK;IACxC,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI,QAAQ,GAAG,CAAC,UAAU;AACxD;AAEA,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,IAAI,EAAE;IAChC,MAAM,IAAI,MACR;AAEJ;AAEA,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;IAC7C,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,IAAI;IACjB,QAAQ,OAAO,IAAI,KAAK;IACxB,MAAM;QACJ,MAAM,OAAO,IAAI;QACjB,MAAM,OAAO,IAAI;IACnB;AACF;AAEA,MAAM,+BAA+B,CAAC,OAAiB,CAAC;;;;;;0FAMkC,EAAE,KAAK;;;;;;AAMjG,CAAC;AAEM,eAAe,qBAAqB,KAAa,EAAE,IAAY;IACpE,IAAI;QACF,MAAM,OAAO,MAAM,YAAY,QAAQ,CAAC;YACtC,MAAM,OAAO,IAAI;YACjB,IAAI;YACJ,SAAS;YACT,MAAM,6BAA6B;QACrC;QAEA,QAAQ,IAAI,CAAC,CAAC,6BAA6B,EAAE,MAAM,MAAM,EAAE,KAAK,SAAS,EAAE;QAC3E,OAAO;YAAE,SAAS;YAAM,WAAW,KAAK,SAAS;QAAC;IAEpD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QAEtD,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 220, "column": 0}, "map": {"version":3,"sources":["file:///Users/tengo/Downloads/MenuQR%202/lib/limits.ts"],"sourcesContent":["export const LIMITS = {\n  // existing limits\n  FREE_MENU_LIMIT: 10,\n  FREE_CATEGORY_LIMIT: 10,\n  FREE_ITEM_LIMIT: 50,\n\n  // resend\n  RESEND_CODE_COOLDOWN_SECONDS: 60,\n\n  // verify email\n  VERIFY_EMAIL_CODE_TTL_MINUTES: 10,\n  VERIFY_EMAIL_MAX_ATTEMPTS: 5,\n  VERIFY_EMAIL_MAX_SENDS: 3,\n\n  // reset password\n  PASSWORD_RESET_CODE_TTL_MINUTES: 10,\n  PASSWORD_RESET_MAX_ATTEMPTS: 5,\n  FORGOT_PASSWORD_MAX_SENDS: 3,\n\n  //blocked user for wrong email or password not ip lock\n  BLOCKED_USER: 5,\n  TIME_BLOCKED_USER:5\n} as const;\n"],"names":[],"mappings":";;;;AAAO,MAAM,SAAS;IACpB,kBAAkB;IAClB,iBAAiB;IACjB,qBAAqB;IACrB,iBAAiB;IAEjB,SAAS;IACT,8BAA8B;IAE9B,eAAe;IACf,+BAA+B;IAC/B,2BAA2B;IAC3B,wBAAwB;IAExB,iBAAiB;IACjB,iCAAiC;IACjC,6BAA6B;IAC7B,2BAA2B;IAE3B,sDAAsD;IACtD,cAAc;IACd,mBAAkB;AACpB"}},
    {"offset": {"line": 247, "column": 0}, "map": {"version":3,"sources":["file:///Users/tengo/Downloads/MenuQR%202/app/api/auth/forgot-password/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport bcrypt from \"bcryptjs\";\nimport { db } from \"@/lib/db\";\nimport { sendVerificationCode } from \"@/lib/mailer\";\nimport { LIMITS } from \"@/lib/limits\";\n\nfunction generateCode() {\n  return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const normalizedEmail = String(body.email || \"\").trim();\n\n    if (!normalizedEmail) {\n      return NextResponse.json({ error: \"emailRequired\" }, { status: 400 });\n    }\n\n    const user = await db.user.findUnique({\n      where: { email: normalizedEmail },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: \"userNotFound\" }, { status: 404 });\n    }\n\n    const last = await db.passwordResetCode.findFirst({\n      where: { email: normalizedEmail },\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    if (last) {\n      const secondsSinceLast = (Date.now() - last.createdAt.getTime()) / 1000;\n\n      if (secondsSinceLast < LIMITS.RESEND_CODE_COOLDOWN_SECONDS) {\n        return NextResponse.json({ error: \"resendCooldown\" }, { status: 429 });\n      }\n\n      if (\n        last.expiresAt > new Date() &&\n        last.attempts >= LIMITS.FORGOT_PASSWORD_MAX_SENDS\n      ) {\n        return NextResponse.json({ error: \"tooManyRequests\" }, { status: 429 });\n      }\n    }\n\n    const code = generateCode();\n    const codeHash = await bcrypt.hash(code, 10);\n    const expiresAt = new Date(\n      Date.now() + LIMITS.PASSWORD_RESET_CODE_TTL_MINUTES * 60 * 1000\n    );\n\n    await db.passwordResetCode.deleteMany({\n      where: { email: normalizedEmail },\n    });\n\n    await db.passwordResetCode.create({\n      data: {\n        email: normalizedEmail,\n        codeHash,\n        expiresAt,\n        attempts:\n          last && last.expiresAt > new Date()\n            ? Math.min(last.attempts + 1, 999)\n            : 1,\n      },\n    });\n\n    await sendVerificationCode(normalizedEmail, code);\n\n    return NextResponse.json({ ok: true });\n  } catch (error) {\n    console.error(\"FORGOT PASSWORD ERROR:\", error);\n    return NextResponse.json({ error: \"generic\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;AAC7D;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,kBAAkB,OAAO,KAAK,KAAK,IAAI,IAAI,IAAI;QAErD,IAAI,CAAC,iBAAiB;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,MAAM,OAAO,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE,OAAO;YAAgB;QAClC;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,MAAM,iHAAE,CAAC,iBAAiB,CAAC,SAAS,CAAC;YAChD,OAAO;gBAAE,OAAO;YAAgB;YAChC,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,IAAI,MAAM;YACR,MAAM,mBAAmB,CAAC,KAAK,GAAG,KAAK,KAAK,SAAS,CAAC,OAAO,EAAE,IAAI;YAEnE,IAAI,mBAAmB,yHAAM,CAAC,4BAA4B,EAAE;gBAC1D,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAiB,GAAG;oBAAE,QAAQ;gBAAI;YACtE;YAEA,IACE,KAAK,SAAS,GAAG,IAAI,UACrB,KAAK,QAAQ,IAAI,yHAAM,CAAC,yBAAyB,EACjD;gBACA,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAkB,GAAG;oBAAE,QAAQ;gBAAI;YACvE;QACF;QAEA,MAAM,OAAO;QACb,MAAM,WAAW,MAAM,8IAAM,CAAC,IAAI,CAAC,MAAM;QACzC,MAAM,YAAY,IAAI,KACpB,KAAK,GAAG,KAAK,yHAAM,CAAC,+BAA+B,GAAG,KAAK;QAG7D,MAAM,iHAAE,CAAC,iBAAiB,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE,OAAO;YAAgB;QAClC;QAEA,MAAM,iHAAE,CAAC,iBAAiB,CAAC,MAAM,CAAC;YAChC,MAAM;gBACJ,OAAO;gBACP;gBACA;gBACA,UACE,QAAQ,KAAK,SAAS,GAAG,IAAI,SACzB,KAAK,GAAG,CAAC,KAAK,QAAQ,GAAG,GAAG,OAC5B;YACR;QACF;QAEA,MAAM,IAAA,uIAAoB,EAAC,iBAAiB;QAE5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAU,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACF"}}]
}